<div class="map-container">
	<google-map [options]="mapOptions()" [height]="mapHeight()" [width]="mapWidth()">
		<map-marker [position]="defaultMarkerPosition" [icon]="markerIcon" />

		@for (entry of mapStores(); track entry.store.id) {
			<map-marker
				#marker="mapMarker"
				[position]="entry.position"
				(mapClick)="openInfoWindow(marker, entry.store, $event)"
			/>
		}

		<map-marker [position]="currentUserLocation()" />

		@if (hasUser()) {
			<map-info-window>
				@if (currentStore(); as store) {
					<h2>{{ store.name }}</h2>
					<p>{{ store.address }}</p>
					<div class="info-actions">
					<button matButton="filled" (click)="onSelectStore(store)">
						Choose store
					</button>
					<button
						matButton="outlined"
						(click)="onGetDirections(store.location)"
					>
						Get directions
					</button>
					</div>
				}
			</map-info-window>
		}

		@if (directionsResults(); as directions) {
			<map-directions-renderer [directions]="directions" />
		}
	</google-map>

	<button matButton="filled" class="nearby-btn" (click)="onGetCurrentLocation()">
		Find nearby stores
	</button>
</div>
