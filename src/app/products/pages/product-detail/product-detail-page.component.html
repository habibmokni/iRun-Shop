@if (product(); as product) {
	<div class="product-page container">
		<div class="product-layout">
			<div class="product-gallery">
				<div class="carousel">
					@for (img of product.variants[0]?.imageList ?? []; track img; let i = $index) {
					<button type="button" class="carousel-slide" (click)="openGallery(i)">
						<img
							[ngSrc]="img"
							[alt]="product.name + ' ' + (i + 1)"
							width="600"
							height="600"
						/>
					</button>
					}
				</div>

				<div class="main-image">
					<img
						[ngSrc]="
							product.variants[0]?.imageList?.[selectedImageIndex()] ??
							product.variants[0]?.imageList?.[0] ??
							''
						"
						alt="{{ product.name }}"
						width="600"
						height="600"
						priority
					/>
				</div>
				<div class="thumbnail-row">
					@for (img of product.variants[0]?.imageList ?? []; track img; let i = $index) {
						<button
							class="thumbnail"
							[class.active]="selectedImageIndex() === i"
							(click)="selectImage(i)"
						>
							<img [ngSrc]="img" alt="Thumbnail {{ i + 1 }}" width="80" height="80" />
						</button>
					}
				</div>
			</div>

			<div class="product-info">
				<div class="product-header">
					<button
						mat-icon-button
						type="button"
						class="info-fav"
						[class.wishlisted]="isWishlisted()"
						(click)="toggleWishlist()"
					>
						<mat-icon>{{ isWishlisted() ? 'favorite' : 'favorite_border' }}</mat-icon>
					</button>
					<span class="brand-label">{{ product.companyName }}</span>

					<div class="title-price-row">
						<h1 class="product-name">{{ product.name }}</h1>
						<div class="price-row">
							@if (product.discount) {
								<span class="price-discount">-{{ product.discount }}%</span>
							}
							<span class="price-original"
								>{{ originalPrice() | number: '1.2-2' }}€</span
							>
							<span class="price-current" [class.on-sale]="product.discount"
								>{{ product.price }}€</span
							>
						</div>
					</div>

					<p class="product-subtitle">
						{{ product.subCategory?.[0] ?? product.category[0] }}
					</p>
				</div>

				@if (similarProducts().length > 1) {
					<div class="section">
						<span class="section-label">Variants</span>
						<div class="variant-selection">
							@for (
								variant of similarProducts();
								track variant.modelNo;
								let i = $index
							) {
								<button
									class="variant-thumb"
									[class.active]="activeVariantIndex() === i"
									(click)="variantSelect(i, variant.modelNo!)"
								>
									<img
										[ngSrc]="
											variant.imageList?.[0] ??
											variant.variants[0]?.imageList?.[0] ??
											''
										"
										[alt]="variant.name"
										width="72"
										height="72"
									/>
								</button>
							}
						</div>
					</div>
				}

				<div class="section">
					<span class="section-label">Size</span>
					<cnc-size-selector [product]="product" (sizeSelected)="sizeSelected($event)" />
				</div>

				<div class="action-row">
					<button matButton="filled" type="button" class="add-btn" (click)="addToCart()">
						<mat-icon>shopping_bag</mat-icon>
						Add to cart
					</button>
					<button
						mat-icon-button
						type="button"
						class="fav-btn"
						[class.wishlisted]="isWishlisted()"
						(click)="toggleWishlist()"
					>
						<mat-icon>{{ isWishlisted() ? 'favorite' : 'favorite_border' }}</mat-icon>
					</button>
				</div>

				<button class="availability-link" (click)="checkAvailability()">
					<div class="availability-left">
						<mat-icon class="availability-icon">room</mat-icon>
						<div class="availability-text">
							<span class="availability-title">Check store availability</span>
							<span class="availability-hint"
								>See which stores near you have this item</span
							>
						</div>
					</div>
					<mat-icon class="chevron-icon">chevron_right</mat-icon>
				</button>

				<div class="perks">
					<div class="perk-card">
						<mat-icon class="perk-icon">local_shipping</mat-icon>
						<span class="perk-text">Free shipping over 80&euro;</span>
					</div>
					<div class="perk-card">
						<mat-icon class="perk-icon">store</mat-icon>
						<span class="perk-text">Free Click &amp; Collect</span>
					</div>
					<div class="perk-card">
						<mat-icon class="perk-icon">replay</mat-icon>
						<span class="perk-text">30-day returns</span>
					</div>
				</div>

				<mat-accordion>
					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>Description</mat-panel-title>
						</mat-expansion-panel-header>
						<div class="accordion-content">
							@if (product.description) {
								<p>{{ product.description }}</p>
							} @else {
								<p>No description available for this product yet.</p>
							}
						</div>
					</mat-expansion-panel>

					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>Reviews</mat-panel-title>
							@if (product.rating) {
								<mat-panel-description>
									<span class="rating-value">{{ product.rating }}</span>
									<mat-icon class="star-icon">star</mat-icon>
									@if (product.reviews) {
										<span class="review-count">({{ product.reviews }})</span>
									}
								</mat-panel-description>
							}
						</mat-expansion-panel-header>
						<div class="accordion-content">
							<p>Be the first to review this product.</p>
						</div>
					</mat-expansion-panel>
				</mat-accordion>
			</div>
		</div>

		<div class="mobile-cta">
			<button matButton="filled" type="button" class="mobile-cta-btn" (click)="addToCart()">
				Add to cart
			</button>
		</div>
	</div>
}
