@if (product(); as product) {
	<div class="product-page container">
		<div class="product-layout">
			<!-- Left: Images -->
			<div class="product-gallery">
				<!-- Mobile: peek carousel -->
				<div class="carousel">
					@for (img of product.variants[0]?.imageList ?? []; track img; let i = $index) {
						<div class="carousel-slide" (click)="openGallery(i)">
							<img
								[ngSrc]="img"
								[alt]="product.name + ' ' + (i + 1)"
								width="600"
								height="600"
							/>
						</div>
					}
				</div>

				<!-- Desktop: main image + thumbnails -->
				<div class="main-image">
					<img
						[ngSrc]="
							product.variants[0]?.imageList?.[selectedImageIndex()] ??
							product.variants[0]?.imageList?.[0] ??
							''
						"
						alt="{{ product.name }}"
						width="600"
						height="600"
						priority
					/>
				</div>
				<div class="thumbnail-row">
					@for (img of product.variants[0]?.imageList ?? []; track img; let i = $index) {
						<button
							class="thumbnail"
							[class.active]="selectedImageIndex() === i"
							(click)="selectImage(i)"
						>
							<img [ngSrc]="img" alt="Thumbnail {{ i + 1 }}" width="80" height="80" />
						</button>
					}
				</div>
			</div>

			<!-- Right: Details -->
			<div class="product-info">
				<!-- Product header (brand + name + subtitle + price) -->
				<div class="product-header">
					<button
						mat-icon-button
						type="button"
						class="info-fav"
						[class.wishlisted]="isWishlisted()"
						(click)="toggleWishlist()"
					>
						<mat-icon>{{ isWishlisted() ? 'favorite' : 'favorite_border' }}</mat-icon>
					</button>
					<span class="brand-label">{{ product.companyName }}</span>
					<h1 class="product-name">{{ product.name }}</h1>
					<p class="product-subtitle">
						{{ product.subCategory?.[0] ?? product.category[0] }}
					</p>

					<!-- Price -->
					<div class="price-row">
						<span class="price-current" [class.on-sale]="product.discount"
							>{{ product.price }}€</span
						>
						<span class="price-original">{{ originalPrice() | number: '1.2-2' }}€</span>
						@if (product.discount) {
							<span class="price-discount">-{{ product.discount }}%</span>
						}
					</div>
				</div>

				<!-- Variant thumbnails -->
				@if (similarProducts().length > 1) {
					<div class="section">
						<span class="section-label">Variants</span>
						<div class="variant-selection">
							@for (
								variant of similarProducts();
								track variant.modelNo;
								let i = $index
							) {
								<button
									class="variant-thumb"
									[class.active]="activeVariantIndex() === i"
									(click)="variantSelect(i, variant.modelNo!)"
								>
									<img
										[ngSrc]="
											variant.imageList?.[0] ??
											variant.variants[0]?.imageList?.[0] ??
											''
										"
										[alt]="variant.name"
										width="72"
										height="72"
									/>
								</button>
							}
						</div>
					</div>
				}

				<!-- Size selector -->
				<div class="section">
					<span class="section-label">Size</span>
					<app-size-selector [product]="product" (sizeSelected)="sizeSelected($event)" />
				</div>

				<!-- Add to cart -->
				<div class="action-row">
					<button matButton="filled" type="button" class="add-btn" (click)="addToCart()">
						<mat-icon>shopping_bag</mat-icon>
						Add to cart
					</button>
					<button
						mat-icon-button
						type="button"
						class="fav-btn"
						[class.wishlisted]="isWishlisted()"
						(click)="toggleWishlist()"
					>
						<mat-icon>{{ isWishlisted() ? 'favorite' : 'favorite_border' }}</mat-icon>
					</button>
				</div>

				<!-- Availability -->
				<button class="availability-link" (click)="checkAvailability()">
					<div class="availability-left">
						<mat-icon class="availability-icon">room</mat-icon>
						<div class="availability-text">
							<span class="availability-title">Check availability</span>
							<span class="availability-hint"
								>Find this product in a store near you</span
							>
						</div>
					</div>
					<mat-icon class="chevron-icon">chevron_right</mat-icon>
				</button>

				<!-- Perks -->
				<div class="perks">
					<div class="perk-card">
						<mat-icon class="perk-icon">local_shipping</mat-icon>
						<span class="perk-text">Free delivery from 80€</span>
					</div>
					<div class="perk-card">
						<mat-icon class="perk-icon">store</mat-icon>
						<span class="perk-text">Free store pickup</span>
					</div>
					<div class="perk-card">
						<mat-icon class="perk-icon">replay</mat-icon>
						<span class="perk-text">Free returns</span>
					</div>
				</div>

				<!-- Description accordion -->
				<mat-accordion>
					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>Description</mat-panel-title>
						</mat-expansion-panel-header>
						<div class="accordion-content">
							@if (product.description) {
								<p>{{ product.description }}</p>
							} @else {
								<p>No description available.</p>
							}
						</div>
					</mat-expansion-panel>

					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>Reviews</mat-panel-title>
							@if (product.rating) {
								<mat-panel-description>
									<span class="rating-value">{{ product.rating }}</span>
									<mat-icon class="star-icon">star</mat-icon>
									@if (product.reviews) {
										<span class="review-count">({{ product.reviews }})</span>
									}
								</mat-panel-description>
							}
						</mat-expansion-panel-header>
						<div class="accordion-content">
							<p>Customer reviews coming soon.</p>
						</div>
					</mat-expansion-panel>
				</mat-accordion>
			</div>
		</div>

		<!-- Mobile sticky CTA -->
		<div class="mobile-cta">
			<button matButton="filled" type="button" class="mobile-cta-btn" (click)="addToCart()">
				Add to cart
			</button>
		</div>
	</div>
}
