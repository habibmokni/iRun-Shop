<div class="admin-container">
	<div class="admin-header">
		<h1>Products</h1>
		<div class="header-actions">
			<a mat-button routerLink="/admin/stores">Manage Stores</a>
		<button mat-flat-button class="primary-button" (click)="onAdd()">
			<mat-icon>add</mat-icon>
			Add Product
		</button>
		</div>
	</div>

	@if (showForm()) {
		<mat-card class="form-card">
			<mat-card-content>
				<h2>{{ editing() ? 'Edit Product' : 'Add Product' }}</h2>
				<form [formGroup]="form" (ngSubmit)="onSubmit()">
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Model No</mat-label>
							<input matInput formControlName="modelNo" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Name</mat-label>
							<input matInput formControlName="name" />
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Company Name</mat-label>
							<input matInput formControlName="companyName" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Price</mat-label>
							<input matInput formControlName="price" type="number" />
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Category (comma separated)</mat-label>
							<input matInput formControlName="category" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Sub-Category (comma separated)</mat-label>
							<input matInput formControlName="subCategory" />
						</mat-form-field>
					</div>

					<mat-form-field appearance="outline" class="full-width">
						<mat-label>Description</mat-label>
						<textarea matInput formControlName="description" rows="3"></textarea>
					</mat-form-field>

					<mat-divider />

					<div class="variants-section">
						<div class="variants-header">
							<h3>Variants</h3>
							<button
								mat-button
								type="button"
								(click)="onAddVariant()"
							>
								<mat-icon>add</mat-icon>
								Add Variant
							</button>
						</div>

						<div formArrayName="variants">
							@for (
								variant of variants.controls;
								track variant;
								let i = $index
							) {
								<mat-card class="variant-card" [formGroupName]="i">
									<div class="variant-header">
										<h4>Variant {{ i + 1 }}</h4>
										<button
											mat-icon-button
											type="button"
											(click)="onRemoveVariant(i)"
										>
											<mat-icon>delete</mat-icon>
										</button>
									</div>
									<mat-form-field appearance="outline">
										<mat-label>Variant ID</mat-label>
										<input matInput formControlName="variantId" />
									</mat-form-field>
									<mat-form-field appearance="outline">
										<mat-label>Sizes (comma separated numbers)</mat-label>
										<input matInput formControlName="sizes" />
									</mat-form-field>
									<mat-form-field appearance="outline">
										<mat-label>In Stock (comma separated numbers)</mat-label>
										<input matInput formControlName="inStock" />
									</mat-form-field>
									<mat-form-field appearance="outline">
										<mat-label>Image URLs (comma separated)</mat-label>
										<input matInput formControlName="imageList" />
									</mat-form-field>
								</mat-card>
							}
						</div>
					</div>

					<div class="form-actions">
					<button mat-flat-button class="secondary-button" type="button" (click)="onCancel()">Cancel</button>
					<button mat-flat-button class="primary-button" type="submit" [disabled]="form.invalid">
						{{ editing() ? 'Update' : 'Add' }}
					</button>
					</div>
				</form>
			</mat-card-content>
		</mat-card>
	}

	<table mat-table [dataSource]="products()" class="product-table">
		<ng-container matColumnDef="modelNo">
			<th mat-header-cell *matHeaderCellDef>Model No</th>
			<td mat-cell *matCellDef="let product">{{ product.modelNo }}</td>
		</ng-container>

		<ng-container matColumnDef="name">
			<th mat-header-cell *matHeaderCellDef>Name</th>
			<td mat-cell *matCellDef="let product">{{ product.name }}</td>
		</ng-container>

		<ng-container matColumnDef="companyName">
			<th mat-header-cell *matHeaderCellDef>Company</th>
			<td mat-cell *matCellDef="let product">{{ product.companyName }}</td>
		</ng-container>

		<ng-container matColumnDef="price">
			<th mat-header-cell *matHeaderCellDef>Price</th>
			<td mat-cell *matCellDef="let product">{{ product.price }} &euro;</td>
		</ng-container>

		<ng-container matColumnDef="variants">
			<th mat-header-cell *matHeaderCellDef>Variants</th>
			<td mat-cell *matCellDef="let product">{{ product.variants?.length ?? 0 }}</td>
		</ng-container>

		<ng-container matColumnDef="actions">
			<th mat-header-cell *matHeaderCellDef></th>
			<td mat-cell *matCellDef="let product">
				<button mat-icon-button (click)="onEdit(product)">
					<mat-icon>edit</mat-icon>
				</button>
				<button mat-icon-button (click)="onDelete(product)">
					<mat-icon>delete</mat-icon>
				</button>
			</td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
	</table>
</div>
