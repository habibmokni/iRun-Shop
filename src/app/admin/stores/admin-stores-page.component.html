<div class="admin-container">
	<div class="admin-header">
		<h1>Stores</h1>
		<div class="header-actions">
			<a mat-button routerLink="/admin/products">Manage Products</a>
			<button mat-flat-button (click)="onAdd()">
				<mat-icon>add</mat-icon>
				Add Store
			</button>
		</div>
	</div>

	@if (showForm()) {
		<mat-card class="form-card">
			<mat-card-content>
				<h2>{{ editing() ? 'Edit Store' : 'Add Store' }}</h2>
				<form [formGroup]="form" (ngSubmit)="onSubmit()">
					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Name</mat-label>
							<input matInput formControlName="name" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Address</mat-label>
							<input matInput formControlName="address" />
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Latitude</mat-label>
							<input matInput formControlName="lat" type="number" step="any" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Longitude</mat-label>
							<input matInput formControlName="lng" type="number" step="any" />
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Opening Time</mat-label>
							<input matInput formControlName="openTime" placeholder="e.g. 10a.m" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Closing Time</mat-label>
							<input
								matInput
								formControlName="closeTime"
								placeholder="e.g. 10p.m"
							/>
						</mat-form-field>
					</div>

					<div class="form-row">
						<mat-form-field appearance="outline">
							<mat-label>Description</mat-label>
							<input matInput formControlName="description" />
						</mat-form-field>
						<mat-form-field appearance="outline">
							<mat-label>Reviews</mat-label>
							<input matInput formControlName="reviews" />
						</mat-form-field>
					</div>

					<mat-checkbox formControlName="isDefaultStore">Default Store</mat-checkbox>

					<div class="form-actions">
						<button mat-button type="button" (click)="onCancel()">Cancel</button>
						<button mat-flat-button type="submit" [disabled]="form.invalid">
							{{ editing() ? 'Update' : 'Add' }}
						</button>
					</div>
				</form>
			</mat-card-content>
		</mat-card>
	}

	<table mat-table [dataSource]="stores()" class="store-table">
		<ng-container matColumnDef="name">
			<th mat-header-cell *matHeaderCellDef>Name</th>
			<td mat-cell *matCellDef="let store">{{ store.name }}</td>
		</ng-container>

		<ng-container matColumnDef="address">
			<th mat-header-cell *matHeaderCellDef>Address</th>
			<td mat-cell *matCellDef="let store">{{ store.address }}</td>
		</ng-container>

		<ng-container matColumnDef="location">
			<th mat-header-cell *matHeaderCellDef>Location</th>
			<td mat-cell *matCellDef="let store">
				{{ store.location.lat | number: '1.4-4' }},
				{{ store.location.lng | number: '1.4-4' }}
			</td>
		</ng-container>

		<ng-container matColumnDef="openingTime">
			<th mat-header-cell *matHeaderCellDef>Hours</th>
			<td mat-cell *matCellDef="let store">
				{{ store.openingTime.open }} - {{ store.openingTime.close }}
			</td>
		</ng-container>

		<ng-container matColumnDef="isDefaultStore">
			<th mat-header-cell *matHeaderCellDef>Default</th>
			<td mat-cell *matCellDef="let store">{{ store.isDefaultStore ? 'Yes' : 'No' }}</td>
		</ng-container>

		<ng-container matColumnDef="products">
			<th mat-header-cell *matHeaderCellDef>Products</th>
			<td mat-cell *matCellDef="let store">{{ store.products?.length ?? 0 }}</td>
		</ng-container>

		<ng-container matColumnDef="actions">
			<th mat-header-cell *matHeaderCellDef></th>
			<td mat-cell *matCellDef="let store">
				<button mat-icon-button (click)="onEdit(store)">
					<mat-icon>edit</mat-icon>
				</button>
				<button mat-icon-button (click)="onDelete(store)">
					<mat-icon>delete</mat-icon>
				</button>
			</td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
	</table>
</div>
