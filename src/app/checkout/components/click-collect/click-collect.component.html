<div class="cnc-section">
	<!-- Step 1: Select Store -->
	<div class="cnc-step">
		<div class="step-header">
			<span class="step-number">1</span>
			<h3 class="step-title">Select a Store</h3>
		</div>

		<div class="store-list">
			@for (store of stores(); track store.id) {
				<app-store-card
					[store]="store"
					[selected]="selectedStore()?.id === store.id"
					[distance]="distanceMap()[store.id]"
					[stock]="stockMap()[store.id]"
					(storeSelect)="onSelectStore($event)"
				/>
			} @empty {
				<p class="empty-msg">No stores available.</p>
			}
		</div>
	</div>

	<!-- Unavailable items warning -->
	@if (selectedStore() && !allAvailable()) {
		<div class="unavailable-banner">
			<div class="unavailable-header-row">
				<mat-icon class="warning-icon">warning</mat-icon>
				<div class="unavailable-text">
					<strong>{{ unavailableProducts().length }} item(s) not available at this store</strong>
					<span>Remove them or select a different store to continue.</span>
				</div>
			</div>
			<div class="unavailable-items-list">
				@for (product of unavailableProducts(); track product.modelNo) {
					<div class="unavailable-item-row">
						<img
							[src]="product.productImage"
							[alt]="product.productName"
							class="unavailable-item-img"
						/>
						<div class="unavailable-item-info">
							<span class="unavailable-item-name">{{ product.productName }}</span>
							<span class="unavailable-item-meta">Size {{ product.size }}</span>
						</div>
					</div>
				}
			</div>
	<button
			matButton="filled"
			type="button"
			(click)="removeUnavailable()"
		>
				Remove Items
			</button>
		</div>
	}

	<!-- Step 2: Pick a Date & Time -->
	@if (selectedStore() && allAvailable()) {
		<div class="cnc-step">
			<div class="step-header">
				<span class="step-number">2</span>
				<h3 class="step-title">Pick a Date & Time</h3>
			</div>

			<div class="datetime-row">
				<mat-form-field appearance="outline" subscriptSizing="dynamic" class="date-field">
					<mat-label>Pickup date</mat-label>
					<input
						matInput
						[matDatepicker]="picker"
						[min]="minDate"
						[max]="maxDate"
						(dateChange)="onDateChange($event.value)"
						readonly
					/>
					<mat-datepicker-toggle matIconSuffix [for]="picker" />
					<mat-datepicker #picker />
				</mat-form-field>

				<mat-form-field appearance="outline" subscriptSizing="dynamic" class="time-field">
					<mat-label>Pickup time</mat-label>
					<input
						matInput
						[matTimepicker]="timePicker"
						[matTimepickerMin]="minTime()"
						[matTimepickerMax]="maxTime()"
						(valueChange)="onTimeChange($event)"
						readonly
					/>
					<mat-timepicker-toggle matIconSuffix [for]="timePicker" />
					<mat-timepicker #timePicker [interval]="'30m'" />
				</mat-form-field>
			</div>
		</div>
	}

	<!-- Summary -->
	@if (isComplete()) {
		<div class="cnc-summary">
			<mat-icon class="check-icon">check_circle</mat-icon>
			<div class="summary-text">
				<strong>{{ selectedStore()?.name }}</strong>
				<span>{{ selectedDate() | date: 'mediumDate' }} at {{ selectedTime() }}</span>
			</div>
		</div>
	}
</div>
