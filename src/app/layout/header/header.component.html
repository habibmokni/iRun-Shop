<mat-toolbar class="header">
	<div class="header-inner container">
		<a class="logo-link" routerLink="/">
			<img
				ngSrc="assets/images/logos/iRun/iRun-pink-logo.png"
				alt="iRun"
				class="logo"
				width="80"
				height="40"
				priority
			/>
		</a>

		<!-- Nav links (desktop only) -->
		<a class="nav-link" routerLink="/home" routerLinkActive="active-link">Home</a>
		<a class="nav-link" routerLink="/products" routerLinkActive="active-link">Collection</a>

		<!-- Search bar (desktop, centered) -->
		<div class="search-wrapper">
			<div class="search-bar desktop-search">
				<mat-icon class="search-icon">search</mat-icon>
				<input
					type="text"
					class="search-input"
					placeholder="Search products..."
					[value]="searchQuery()"
					(input)="onSearchInput($event)"
					(keydown.enter)="onSearch()"
				/>
				@if (searchQuery()) {
					<button class="search-clear" (click)="clearSearch()">
						<mat-icon>close</mat-icon>
					</button>
				}
			</div>
		</div>

		<!-- Filler for mobile (hidden on desktop where search-wrapper fills the space) -->
		<span class="mobile-filler"></span>

		<!-- Action icons -->
		<div class="header-actions">
			<!-- Mobile search toggle -->
			<button class="action-item mobile-search-toggle" (click)="toggleMobileSearch()" aria-label="Search">
				<mat-icon>search</mat-icon>
			</button>

			<!-- Store selector -->
			<a class="action-item" routerLink="/storeselector" aria-label="Store selector">
				<mat-icon fontSet="material-icons-outlined">where_to_vote</mat-icon>
				<span class="action-label">Stores</span>
			</a>

			<!-- User menu -->
			<button class="action-item" [matMenuTriggerFor]="userMenu" aria-label="User menu">
				<mat-icon>person_outline</mat-icon>
				<span class="action-label">Account</span>
			</button>

			<mat-menu #userMenu="matMenu" class="user-menu-panel">
				@if (isLoggedIn()) {
					<a mat-menu-item routerLink="user-profile">
						<mat-icon fontSet="material-icons-outlined">person</mat-icon>
						<span>Profile</span>
					</a>
					<a mat-menu-item (click)="onLogout()" class="logout-item">
						<mat-icon fontSet="material-icons-outlined">logout</mat-icon>
						<span>Log out</span>
					</a>
				} @else {
					<a mat-menu-item routerLink="/login">
						<mat-icon fontSet="material-icons-outlined">login</mat-icon>
						<span>Log in</span>
					</a>
					<a mat-menu-item routerLink="/register">
						<mat-icon fontSet="material-icons-outlined">person_add</mat-icon>
						<span>Create account</span>
					</a>
				}
			</mat-menu>

			<!-- Wishlist -->
			<a
				class="action-item"
				routerLink="/user-profile"
				[queryParams]="{ tab: 'wishlist' }"
				aria-label="Wishlist"
			>
				<mat-icon
					[matBadge]="wishlistCount()"
					[matBadgeHidden]="wishlistCount() === 0"
					matBadgeColor="primary"
					fontSet="material-icons-outlined"
				>
					favorite_border
				</mat-icon>
				<span class="action-label">Wishlist</span>
			</a>

			<!-- Cart -->
			<a class="action-item" routerLink="/shoppingcart" aria-label="Shopping cart">
				<mat-icon
					[matBadge]="cartCount()"
					[matBadgeHidden]="cartCount() === 0"
					matBadgeColor="primary"
					fontSet="material-icons-outlined"
				>
					shopping_bag
				</mat-icon>
				<span class="action-label">Cart</span>
			</a>
		</div>
	</div>
</mat-toolbar>

<!-- Mobile search overlay -->
@if (mobileSearchOpen()) {
	<div class="mobile-search-overlay">
		<div class="mobile-search-bar">
			<mat-icon class="search-icon">search</mat-icon>
			<input
				type="text"
				class="search-input"
				placeholder="Search products..."
				[value]="searchQuery()"
				(input)="onSearchInput($event)"
				(keydown.enter)="onSearch(); toggleMobileSearch()"
				autofocus
			/>
			<button class="search-clear" (click)="toggleMobileSearch()">
				<mat-icon>close</mat-icon>
			</button>
		</div>
	</div>
}
