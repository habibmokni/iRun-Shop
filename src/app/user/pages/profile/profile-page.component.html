@if (!isLoggedIn()) {
	<div class="empty-state container-narrow">
		<mat-icon class="empty-icon">person_outline</mat-icon>
		<h2>Please log in</h2>
		<p>Log in to view your account details, wishlist, and orders.</p>
		<a matButton="filled" routerLink="/login">Log in</a>
	</div>
} @else {
	<div class="profile-page container-narrow">
		<!-- Profile header -->
		<div class="profile-header">
			<div class="avatar">
				<mat-icon class="avatar-icon">person</mat-icon>
			</div>
			<div class="header-info">
				<h1 class="user-name">
					{{ user()?.firstName ?? '' }} {{ user()?.lastName ?? '' }}
				</h1>
				<span class="user-email">{{ user()?.email }}</span>
			</div>
		<button
			matButton="outlined"
			class="logout-btn"
			(click)="logout()"
		>
				<mat-icon>logout</mat-icon>
				Log out
			</button>
		</div>

		<!-- Tab navigation -->
		<nav class="profile-tabs">
			<button
				class="tab"
				[class.active]="activeTab() === 'info'"
				(click)="activeTab.set('info')"
			>
				<mat-icon>person</mat-icon>
				Info
			</button>
			<button
				class="tab"
				[class.active]="activeTab() === 'wishlist'"
				(click)="activeTab.set('wishlist')"
			>
				<mat-icon>favorite</mat-icon>
				Wishlist
				@if (wishlistProducts().length) {
					<span class="tab-badge">{{ wishlistProducts().length }}</span>
				}
			</button>
			<button
				class="tab"
				[class.active]="activeTab() === 'orders'"
				(click)="activeTab.set('orders')"
			>
				<mat-icon>receipt_long</mat-icon>
				Orders
				@if (orders().length) {
					<span class="tab-badge">{{ orders().length }}</span>
				}
			</button>
		</nav>

		<!-- Tab content -->
		<div class="tab-content">
			<!-- ── Info tab ── -->
			@if (activeTab() === 'info') {
				<div class="info-section">
					<h2 class="section-title">Personal Details</h2>
					<div class="info-card">
						<div class="info-row">
							<mat-icon class="info-icon">person_outline</mat-icon>
							<div class="info-content">
								<span class="info-label">Full Name</span>
								<span class="info-value">
									{{ (user()?.firstName ?? '') + ' ' + (user()?.lastName ?? '') | titlecase }}
								</span>
							</div>
						</div>
						<div class="info-divider"></div>
						<div class="info-row">
							<mat-icon class="info-icon">mail_outline</mat-icon>
							<div class="info-content">
								<span class="info-label">Email</span>
								<span class="info-value">{{ user()?.email ?? '–' }}</span>
							</div>
						</div>
						<div class="info-divider"></div>
						<div class="info-row">
							<mat-icon class="info-icon">home_outlined</mat-icon>
							<div class="info-content">
								<span class="info-label">Address</span>
								<span class="info-value">{{ user()?.address ?? '–' }}</span>
							</div>
						</div>
						<div class="info-divider"></div>
						<div class="info-row">
							<mat-icon class="info-icon">pin_drop</mat-icon>
							<div class="info-content">
								<span class="info-label">Zip Code</span>
								<span class="info-value">{{ user()?.zipCode ?? '–' }}</span>
							</div>
						</div>
					</div>
				</div>

				<div class="info-section">
					<h2 class="section-title">My Store</h2>
					@if (favoriteStore()) {
						<div class="store-card">
							<mat-icon class="store-icon">store</mat-icon>
							<div class="store-details">
								<span class="store-name">{{ favoriteStore()?.name }}</span>
								<span class="store-address">{{ favoriteStore()?.address }}</span>
							</div>
							<a class="change-store-link" routerLink="/storeselector">
								Change
								<mat-icon class="change-store-chevron">chevron_right</mat-icon>
							</a>
						</div>
					} @else {
						<div class="store-card store-card--empty">
							<mat-icon class="store-icon">store</mat-icon>
							<div class="store-details">
								<span class="store-name">No store selected</span>
								<span class="store-address">Select a store for stock availability and click &amp; collect</span>
							</div>
							<a class="change-store-link" routerLink="/storeselector">
								Select
								<mat-icon class="change-store-chevron">chevron_right</mat-icon>
							</a>
						</div>
					}
				</div>
			}

			<!-- ── Wishlist tab ── -->
			@if (activeTab() === 'wishlist') {
				@if (wishlistProducts().length) {
					<div class="wishlist-grid">
						@for (product of wishlistProducts(); track product.modelNo) {
							<a class="wishlist-card" [routerLink]="['/products', product.modelNo]">
								<div class="wishlist-image">
									<img
										[ngSrc]="product.variants[0]?.imageList?.[0] ?? ''"
										[alt]="product.name"
										width="120"
										height="120"
									/>
								</div>
								<div class="wishlist-info">
									<span class="wishlist-brand">{{ product.companyName }}</span>
									<span class="wishlist-name">{{ product.name }}</span>
									<span class="wishlist-price">{{ product.price | number: '1.2-2' }}€</span>
								</div>
								<button
									mat-icon-button
									class="wishlist-remove"
									(click)="removeFromWishlist(product.modelNo!); $event.preventDefault(); $event.stopPropagation()"
								>
									<mat-icon>close</mat-icon>
								</button>
							</a>
						}
					</div>
				} @else {
					<div class="tab-empty">
						<mat-icon class="tab-empty-icon">favorite_border</mat-icon>
						<p>Your wishlist is empty</p>
						<a matButton="filled" routerLink="/products">Browse products</a>
					</div>
				}
			}

			<!-- ── Orders tab ── -->
			@if (activeTab() === 'orders') {
				@if (orders().length) {
					<div class="orders-list">
						@for (order of orders(); track order.orderId) {
							<div class="order-card">
								<div class="order-header">
									<div class="order-id">
										<mat-icon class="order-icon">tag</mat-icon>
										Order #{{ order.orderId }}
									</div>
									<span class="order-total">{{ order.orderPrice | number: '1.2-2' }}€</span>
								</div>
								<div class="order-meta">
									<span class="order-delivery">
										<mat-icon class="meta-icon">
											{{ order.pickupType === 'Click & Collect' ? 'store' : 'local_shipping' }}
										</mat-icon>
										{{ order.pickupType }}
									</span>
									@if (order.paymentOption) {
										<span class="order-payment">
											<mat-icon class="meta-icon">credit_card</mat-icon>
											{{ order.paymentOption }}
										</span>
									}
								</div>
								<div class="order-items">
									@for (item of order.productsOrdered; track item.modelNo) {
										<div class="order-item">
											<img
												[ngSrc]="item.productImage"
												[alt]="item.productName"
												width="48"
												height="48"
												class="order-item-img"
											/>
											<div class="order-item-info">
												<span class="order-item-name">{{ item.productName }}</span>
												<span class="order-item-meta">
													Size {{ item.size }} &middot; Qty {{ item.noOfItems }}
												</span>
											</div>
											<span class="order-item-price">
												{{ item.price * item.noOfItems | number: '1.2-2' }}€
											</span>
										</div>
									}
								</div>
							</div>
						}
					</div>
				} @else {
					<div class="tab-empty">
						<mat-icon class="tab-empty-icon">receipt_long</mat-icon>
						<p>No orders yet</p>
						<a matButton="filled" routerLink="/products">Start shopping</a>
					</div>
				}
			}
		</div>
	</div>
}
